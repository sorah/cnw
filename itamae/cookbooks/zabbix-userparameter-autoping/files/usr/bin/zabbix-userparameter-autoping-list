#!/usr/bin/env ruby
require 'json'

system *%w(ip route get 2001:4860:4860::8888), out: File::NULL, err: File::NULL
v6 = $?.success?

dests = JSON.parse(File.read('/etc/autoping.json'))
data = dests.map do |dest|
  next if dest['v6'] && !v6
  {'{#HOST}' => dest.fetch('host')}
end.compact

puts({data: data}.to_json)
